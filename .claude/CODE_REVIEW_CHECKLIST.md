# AI 編碼審查清單

> 每次 AI 完成代碼修改後，必須執行此清單

## 📋 基礎檢查

### 1. 編譯檢查
- [ ] 執行 `xcodebuild build` 成功
- [ ] 無編譯錯誤
- [ ] 無編譯警告（或已說明原因）

### 2. 語法完整性
- [ ] 所有開頭的 `{` 都有對應的 `}`
- [ ] 所有函數都有完整的實作（非空）
- [ ] 所有 import 都必要且正確

---

## 🔗 UI 綁定檢查

### 3. 按鈕綁定
- [ ] 所有 `Button` 都有非空的 action
- [ ] action 中呼叫的函數都存在
- [ ] 函數名稱拼寫正確（大小寫）

### 4. 狀態綁定
- [ ] 所有需要綁定的變數都有 `@State` / `@Binding`
- [ ] 綁定時都使用了 `$` 符號
- [ ] 沒有遺漏任何 property wrapper

### 5. 導航綁定
- [ ] `NavigationLink` 的目標視圖存在
- [ ] `.sheet` / `.alert` 的綁定變數已宣告
- [ ] 傳遞的參數類型正確

---

## 💾 資料處理檢查

### 6. 空值安全
- [ ] 沒有強制解包 `!` （除非有充分理由）
- [ ] 使用 `guard let` 或 `if let` 處理 optional
- [ ] 有適當的錯誤處理

### 7. 執行緒安全
- [ ] UI 更新都在主執行緒
- [ ] 使用 `@MainActor` 或 `DispatchQueue.main`
- [ ] 背景任務不會直接修改 UI

### 8. 記憶體管理
- [ ] closure 中使用 `[weak self]` 避免循環參照
- [ ] Timer 有適當的 invalidate
- [ ] Notification observer 有移除

---

## 🏗️ 架構檢查

### 9. 分層正確
- [ ] View 不直接存取 Core Data
- [ ] ViewModel 不依賴 View
- [ ] 遵守依賴注入原則

### 10. 命名規範
- [ ] 類別/結構使用 PascalCase
- [ ] 函數/變數使用 camelCase
- [ ] 私有成員使用 `private` 關鍵字

---

## 📝 文檔檢查

### 11. 註解完整性
- [ ] 複雜邏輯有解釋註解
- [ ] public API 有文檔註解 `///`
- [ ] TODO 標記需要後續處理的地方

### 12. 修改記錄
- [ ] 列出修改的檔案清單
- [ ] 說明修改的原因
- [ ] 標註潛在影響

---

## 🧪 測試建議

### 13. 手動測試項目
提供需要測試的項目清單：
- [ ] 正常流程測試
- [ ] 邊界條件測試（空資料、極大資料）
- [ ] 錯誤處理測試（網路失敗、權限拒絕）
- [ ] UI 響應測試（按鈕點擊、輸入驗證）

---

## ❌ 常見錯誤檢查

### 14. Swift 特定問題
- [ ] 沒有在 `viewDidLoad` 更新 UI（應在 `viewDidAppear`）
- [ ] 沒有濫用 `@Published` 在不需要的地方
- [ ] SwiftUI 的 `body` 不包含副作用

### 15. Core Data 問題
- [ ] 所有使用的屬性在 `.xcdatamodeld` 存在
- [ ] `NSManagedObject` 在正確的 context
- [ ] 有呼叫 `context.save()` 保存變更

---

## 📊 完成檢查報告格式

```markdown
# 代碼審查報告

## ✅ 通過檢查
- [✓] 編譯成功
- [✓] UI 綁定完整
- [✓] 資料處理安全
- [✓] 架構符合規範

## ⚠️ 需要注意
- 第 45 行使用強制解包，已加入 TODO
- 背景任務較耗時，建議加入進度指示

## 📝 修改摘要
- 新增檔案：ExportService.swift
- 修改檔案：ModernEntryListView.swift (新增匯出按鈕)
- 修改檔案：EntryViewModel.swift (新增 exportBibTeX 函數)

## 🧪 手動測試建議
1. 測試按鈕點擊是否觸發匯出
2. 測試無選取項目時的錯誤提示
3. 測試匯出檔案內容正確性
4. 測試大量資料（1000+ 筆）的效能
```

---

## 🚨 紅色警告標記

以下情況**必須**停下來討論：
- 🔴 修改 Core Data 模型
- 🔴 刪除現有函數
- 🔴 更改 public API
- 🔴 影響多個模組
- 🔴 潛在的破壞性變更

---

**使用方式：**
每次 AI 完成代碼後，要求：「請按照 CODE_REVIEW_CHECKLIST.md 自我審查」
